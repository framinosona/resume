---
import type { CollectionEntry } from "astro:content";

interface Props {
  diploma: CollectionEntry<"diplomas">;
}

const { diploma } = Astro.props;

// Simple markdown processor for inline formatting
function processMarkdown(text: string): string {
  if (!text) return text;

  return (
    text
      // Bold: **text** or __text__
      .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>")
      .replace(/__(.*?)__/g, "<strong>$1</strong>")
      // Italic: *text* or _text_
      .replace(/(?<!\*)\*([^*]+?)\*(?!\*)/g, "<em>$1</em>")
      .replace(/(?<!_)_([^_]+?)_(?!_)/g, "<em>$1</em>")
      // Code: `text`
      .replace(
        /`([^`]+?)`/g,
        '<code class="bg-gray-100 dark:bg-gray-800 px-1 py-0.5 rounded text-sm">$1</code>'
      )
      // Links: [text](url)
      .replace(
        /\[([^\]]+?)\]\(([^)]+?)\)/g,
        '<a href="$2" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 underline">$1</a>'
      )
  );
}
---

<article class="bg-white dark:bg-slate-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700">
  <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between mb-4">
    <div class="flex flex-row">
      {diploma.data.logo && (
        <img
          src={diploma.data.logo}
          alt={`${diploma.data.institution} logo`}
          class="sm:w-20 sm:h-20 object-contain bg-white/10 rounded-lg mr-4 w-16 h-16"
        />
      )}
      <div>
        <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
          {diploma.data.degree}
        </h3>
        <p class="text-lg text-blue-600 dark:text-blue-400 font-medium">
          {diploma.data.institution}
        </p>
        <p class="text-gray-600 dark:text-gray-400">
          {diploma.data.field} â€¢ {diploma.data.location}
        </p>
      </div>
    </div>
    <div class="text-sm text-gray-500 dark:text-gray-400 mt-2 sm:mt-0">
      {diploma.data.date.toLocaleDateString("en-US", {
        month: "short",
        year: "numeric",
      })}
    </div>
  </div>

  <p
    class="text-gray-700 dark:text-gray-300"
    set:html={processMarkdown(diploma.data.description || "")}
  />

  {diploma.data.score && (
    <div class="mt-4">
      <span class="inline-flex items-center px-3 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-sm rounded-full font-medium">
        ðŸ“Š Score: {diploma.data.score}
      </span>
      {diploma.data.level && (
        <span class="inline-flex items-center px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-sm rounded-full font-medium ml-2">
          ðŸŽ¯ Level: {diploma.data.level}
        </span>
      )}
    </div>
  )}

  {diploma.data.recertification && (
    <div class="mt-4">
      <span class="inline-flex items-center px-3 py-1 bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 text-sm rounded-full font-medium">
        ðŸ”„ Recertified:{" "}
        {new Date(
          diploma.data.recertification
        ).toLocaleDateString("en-US", {
          month: "short",
          year: "numeric",
        })}
      </span>
    </div>
  )}

  {diploma.data.comments.length > 0 && (
    <div class="mt-4">
      <div class="flex flex-wrap gap-2">
        {diploma.data.comments.map((comment: string) => (
          <span class="px-3 py-1 bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 text-sm rounded-full">
            {comment}
          </span>
        ))}
      </div>
    </div>
  )}
</article>
