---
import type { CollectionEntry } from "astro:content";

interface Props {
  education: CollectionEntry<"education">;
  diplomas: CollectionEntry<"diplomas">[];
  showReadMore?: boolean;
}

const { education, diplomas, showReadMore = false } = Astro.props;

// Simple markdown processor for inline formatting
function processMarkdown(text: string): string {
  if (!text) return text;

  return (
    text
      // Bold: **text** or __text__
      .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>")
      .replace(/__(.*?)__/g, "<strong>$1</strong>")
      // Italic: *text* or _text_
      .replace(/(?<!\*)\*([^*]+?)\*(?!\*)/g, "<em>$1</em>")
      .replace(/(?<!_)_([^_]+?)_(?!_)/g, "<em>$1</em>")
      // Code: `text`
      .replace(
        /`([^`]+?)`/g,
        '<code class="bg-gray-100 dark:bg-gray-800 px-1 py-0.5 rounded text-sm">$1</code>'
      )
      // Links: [text](url)
      .replace(
        /\[([^\]]+?)\]\(([^)]+?)\)/g,
        '<a href="$2" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 underline">$1</a>'
      )
  );
}
---

<article
  class="bg-white dark:bg-slate-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700"
>
  <div class="flex flex-col sm:flex-row sm:justify-between mb-4">
    <div class="flex flex-row">
      {
        education.data.logo && (
          <img
            src={education.data.logo}
            alt={`${education.data.institution} logo`}
            class="sm:w-20 sm:h-20 object-contain bg-white/10 rounded-lg mr-4 w-16 h-16"
          />
        )
      }
      <div>
        <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
          {education.data.program}
        </h3>
        <p class="text-lg text-blue-600 dark:text-blue-400 font-medium">
          {education.data.institution}
        </p>
        <p class="text-gray-600 dark:text-gray-400">
          {education.data.location}
        </p>
      </div>
    </div>
    <div class="text-sm text-gray-500 dark:text-gray-400 mt-2 sm:mt-0">
      {
        education.data.startDate.toLocaleDateString("en-US", {
          month: "short",
          year: "numeric",
        })
      }{" "}
      -
      {
        education.data.endDate
          ? education.data.endDate.toLocaleDateString("en-US", {
              month: "short",
              year: "numeric",
            })
          : "Present"
      }
    </div>
  </div>

  {
    education.data.achievements && education.data.achievements.length > 0 && (
      <div class="mb-4">
        <h4 class="font-medium text-gray-900 dark:text-white mb-2">
          Key Achievements:
        </h4>
        <ul class="list-disc list-inside space-y-1">
          {education.data.achievements.map((achievement: string) => (
            <li
              class="text-gray-700 dark:text-gray-300"
              set:html={processMarkdown(achievement)}
            />
          ))}
        </ul>
      </div>
    )
  }

  {
    education.data.relatedDiplomas &&
      education.data.relatedDiplomas.length > 0 && (
        <div class="mb-4">
          <h4 class="font-medium text-gray-900 dark:text-white mb-2">
            Related Diplomas:
          </h4>
          <div class="flex flex-wrap gap-2">
            {education.data.relatedDiplomas.map((diploma: string) => {
              const foundDiploma = diplomas.find((d) => d.slug === diploma);
              return foundDiploma ? (
                <a
                  href={`/diplomas/${diploma}`}
                  class="px-3 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-sm rounded-full hover:bg-green-200 dark:hover:bg-green-800 transition-colors"
                >
                  {foundDiploma.data.degree}
                </a>
              ) : (
                <span class="px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 text-sm rounded-full">
                  {diploma}
                </span>
              );
            })}
          </div>
        </div>
      )
  }

  {showReadMore && (
  <a
    href={`/education/${education.slug}`}
    class="inline-flex items-center text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium"
  >
    Read more
    <svg
      class="w-4 h-4 ml-2"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M9 5l7 7-7 7"></path>
    </svg>
  </a>
  )}
</article>
