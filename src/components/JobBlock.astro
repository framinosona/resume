---
import type { CollectionEntry } from "astro:content";

interface Props {
  job: CollectionEntry<"jobs">;
  showReadMore?: boolean;
}

const { job, showReadMore = false } = Astro.props;

// Simple markdown processor for inline formatting
function processMarkdown(text: string): string {
  if (!text) return text;

  return (
    text
      // Bold: **text** or __text__
      .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>")
      .replace(/__(.*?)__/g, "<strong>$1</strong>")
      // Italic: *text* or _text_
      .replace(/(?<!\*)\*([^*]+?)\*(?!\*)/g, "<em>$1</em>")
      .replace(/(?<!_)_([^_]+?)_(?!_)/g, "<em>$1</em>")
      // Code: `text`
      .replace(
        /`([^`]+?)`/g,
        '<code class="bg-gray-100 dark:bg-gray-800 px-1 py-0.5 rounded text-sm">$1</code>'
      )
      // Links: [text](url)
      .replace(
        /\[([^\]]+?)\]\(([^)]+?)\)/g,
        '<a href="$2" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 underline">$1</a>'
      )
  );
}
---

<article
  class="bg-white dark:bg-slate-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700"
>
  <div class="flex flex-col sm:flex-row sm:justify-between mb-4">
    <div class="flex flex-row">
      {
        job.data.logo && (
          <img
            src={job.data.logo}
            alt={`${job.data.company} logo`}
            class="sm:w-20 sm:h-20 object-contain bg-white/10 rounded-lg mr-4 w-16 h-16"
          />
        )
      }
      <div>
        <h3 class="text-xl font-semibold text-gray-900 dark:text-white">
          {job.data.position}
        </h3>
        <p class="text-lg text-blue-600 dark:text-blue-400 font-medium">
          {job.data.company}
        </p>
        <p class="text-gray-600 dark:text-gray-400">
          {job.data.location}
        </p>
      </div>
    </div>

    <div
      class="text-sm text-gray-500 dark:text-gray-400 mt-2 sm:mt-0 text-center md:text-left"
    >
      <p class="mb-2">
        {
          job.data.startDate.toLocaleDateString("en-US", {
            month: "short",
            year: "numeric",
          })
        }{" "}
        -
        {
          job.data.endDate
            ? job.data.endDate.toLocaleDateString("en-US", {
                month: "short",
                year: "numeric",
              })
            : "Present"
        }
      </p>
      <div class="flex flex-wrap gap-1 justify-center md:justify-end text-center md:text-left">
        {
          job.data.current && (
            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
              Current
            </span>
          )
        }
        <span
          class={`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${
            job.data.tags && job.data.tags.includes("Part-time")
              ? "bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200"
              : "bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"
          }`}
        >
          {
            job.data.tags && job.data.tags.includes("Part-time")
              ? "Part-time"
              : "Full-time"
          }
        </span>
      </div>
    </div>
  </div>

  <p
    class="text-gray-700 dark:text-gray-300 mb-4"
    set:html={processMarkdown(job.data.description)}
  />

  {
    job.data.achievements.length > 0 && (
      <div class="mb-4">
        <h4 class="font-medium text-gray-900 dark:text-white mb-2">
          Key Achievements:
        </h4>
        <ul class="list-disc list-inside space-y-1">
          {job.data.achievements.map((achievement) => (
            <li
              class="text-gray-700 dark:text-gray-300"
              set:html={processMarkdown(achievement)}
            />
          ))}
        </ul>
      </div>
    )
  }

  {
    job.data.technologies.length > 0 && (
      <div class="flex flex-wrap gap-2">
        {job.data.technologies.map((tech) => (
          <span class="px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-sm rounded-full">
            {tech}
          </span>
        ))}
      </div>
    )
  }

  {
    showReadMore && (
      <a
        href={`/jobs/${job.slug}`}
        class="inline-flex items-center text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium mt-4"
      >
        Read more
        <svg
          class="w-4 h-4 ml-2"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 5l7 7-7 7"
          />
        </svg>
      </a>
    )
  }
</article>
