---
import { getCollection } from "astro:content";
import MainLayout from "../layouts/MainLayout.astro";

// Calculated from start date of 2012 to today
const xpYears = new Date().getFullYear() - 2012;

const hackathons = await getCollection("hackathons");
hackathons.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

// Get unique technologies for filtering, ordered by frequency
const technologyCounts = hackathons
  .flatMap((h) => h.data.technologies)
  .reduce(
    (acc, tech) => {
      acc[tech] = (acc[tech] || 0) + 1;
      return acc;
    },
    {} as Record<string, number>
  );

const allTechnologies = Object.keys(technologyCounts).sort(
  (a, b) => technologyCounts[b] - technologyCounts[a]
);

// Categorize hackathons by type
const winners = hackathons.filter(
  (h) => h.data.tags && h.data.tags.includes("Victory")
);
const jury = hackathons.filter(
  (h) =>
    h.data.tags &&
    (h.data.tags.includes("Jury") || h.data.tags.includes("Judge"))
);
const coaching = hackathons.filter(
  (h) =>
    h.data.tags &&
    (h.data.tags.includes("Coach") || h.data.tags.includes("Mentor"))
);

// Get years for timeline
const years = [
  ...new Set(hackathons.map((h) => h.data.date.getFullYear())),
].sort((a: number, b: number) => b - a);
---

<MainLayout
  title="Hackathons - Francois Raminosona"
  description="Comprehensive collection of hackathon experiences spanning 12+ years, from participant victories to coaching and mentoring roles in technology innovation competitions"
>
  <div class="bg-white dark:bg-slate-900 min-h-screen">
    <!-- Header -->
    <header
      class="bg-gradient-to-r from-purple-600 to-blue-600 text-white py-16"
    >
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center">
          <h1 class="text-4xl font-bold mb-4">Hackathons & Competitions</h1>
          <p class="text-xl text-purple-100 max-w-3xl mx-auto">
            {xpYears} years of innovation competitions, from national victories To
            : mentoring teams, through being a judge and co-organizer.
          </p>
          <div class="mt-8 flex flex-wrap justify-center gap-6 text-lg">
            <div class="bg-white/10 backdrop-blur-sm rounded-lg px-4 py-2">
              üèÜ <span class="font-bold">{winners.length}</span> Victories
            </div>
            <div class="bg-white/10 backdrop-blur-sm rounded-lg px-4 py-2">
              üë®‚Äçüè´ <span class="font-bold">{coaching.length}</span> Coaching Roles
            </div>
            <div class="bg-white/10 backdrop-blur-sm rounded-lg px-4 py-2">
              ‚öñÔ∏è <span class="font-bold">{jury.length}</span> Jury Roles
            </div>
            <div class="bg-white/10 backdrop-blur-sm rounded-lg px-4 py-2">
              <span class="font-bold">{hackathons.length}</span> Total Events
            </div>
          </div>
        </div>
      </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <!-- Filter Section -->
      <div class="mb-12">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
          Filter Hackathons
        </h2>

        <!-- Technology Filters -->
        <div class="mb-6">
          <h3
            class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-3"
          >
            By Technology
          </h3>
          <div class="flex flex-wrap gap-2" id="technology-filters">
            <button
              class="filter-btn active px-4 py-2 rounded-full border border-purple-600 text-purple-600 hover:bg-purple-600 hover:text-white transition-colors"
              data-filter="all"
              data-type="technology"
            >
              All Technologies
            </button>
            {
              allTechnologies.slice(0, 10).map((tech: string) => (
                <button
                  class="filter-btn px-4 py-2 rounded-full border border-purple-600 text-purple-600 hover:bg-purple-600 hover:text-white transition-colors"
                  data-filter={tech.toLowerCase().replace(/[^a-z0-9]/g, "-")}
                  data-type="technology"
                >
                  {tech}
                </button>
              ))
            }
          </div>
        </div>

        <!-- Year Filters -->
        <div class="mb-6">
          <h3
            class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-3"
          >
            By Year
          </h3>
          <div class="flex flex-wrap gap-2" id="year-filters">
            <button
              class="filter-btn active px-4 py-2 rounded-full border border-blue-600 text-blue-600 hover:bg-blue-600 hover:text-white transition-colors"
              data-filter="all"
              data-type="year"
            >
              All Years
            </button>
            {
              years.map((year: number) => (
                <button
                  class="filter-btn px-4 py-2 rounded-full border border-blue-600 text-blue-600 hover:bg-blue-600 hover:text-white transition-colors"
                  data-filter={year.toString()}
                  data-type="year"
                >
                  {year}
                </button>
              ))
            }
          </div>
        </div>

        <!-- Role Filters -->
        <div class="mb-6">
          <h3
            class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-3"
          >
            By Role
          </h3>
          <div class="flex flex-wrap gap-2" id="role-filters">
            <button
              class="filter-btn active px-4 py-2 rounded-full border border-green-600 text-green-600 hover:bg-green-600 hover:text-white transition-colors"
              data-filter="all"
              data-type="role"
            >
              All Roles
            </button>
            <button
              class="filter-btn px-4 py-2 rounded-full border border-green-600 text-green-600 hover:bg-green-600 hover:text-white transition-colors"
              data-filter="winner"
              data-type="role"
            >
              üèÜ Winners
            </button>
            <button
              class="filter-btn px-4 py-2 rounded-full border border-green-600 text-green-600 hover:bg-green-600 hover:text-white transition-colors"
              data-filter="coach"
              data-type="role"
            >
              üë®‚Äçüè´ Coach/Mentor
            </button>
            <button
              class="filter-btn px-4 py-2 rounded-full border border-green-600 text-green-600 hover:bg-green-600 hover:text-white transition-colors"
              data-filter="jury"
              data-type="role"
            >
              ‚öñÔ∏è Jury
            </button>
          </div>
        </div>
      </div>

      <!-- All Hackathons -->
      <section>
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-8">
          All Hackathons & Competitions
        </h2>
        <div
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"
          id="hackathons-grid"
        >
          {
            hackathons.map((hackathon) => {
              // Categorize hackathons by type
              const isWinner =
                hackathon.data.tags && hackathon.data.tags.includes("Victory");
              const isJury =
                hackathon.data.tags &&
                (hackathon.data.tags.includes("Jury") ||
                  hackathon.data.tags.includes("Judge"));
              const isCoaching =
                hackathon.data.tags &&
                (hackathon.data.tags.includes("Coach") ||
                  hackathon.data.tags.includes("Mentor"));

              const role = isWinner
                ? "winner"
                : isJury
                  ? "jury"
                  : isCoaching
                    ? "coach"
                    : "participant";

              return (
                <article
                  class={`hackathon-card bg-white dark:bg-slate-800 rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow ${
                    isWinner
                      ? "dark:border-yellow-200 border-yellow-500 border-2"
                      : isCoaching
                        ? "dark:border-blue-200 border-blue-500 border-2"
                        : "dark:border-purple-200 border-purple-500 border-2"
                  }`}
                  data-technologies={hackathon.data.technologies
                    .map((t) => t.toLowerCase().replace(/[^a-z0-9]/g, "-"))
                    .join(" ")}
                  data-year={hackathon.data.date.getFullYear().toString()}
                  data-role={role}
                >
                  {hackathon.data.image && (
                    <img
                      src={hackathon.data.image}
                      alt={hackathon.data.title}
                      class="w-full h-48 object-cover"
                    />
                  )}
                  <div class="p-6">
                    <div class="flex items-center justify-between mb-4">
                      <span class="text-sm text-gray-500 dark:text-gray-400">
                        {hackathon.data.date.toLocaleDateString("en-US", {
                          year: "numeric",
                          month: "short",
                        })}
                      </span>
                      <span class="text-xs text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded">
                        {hackathon.data.duration}
                      </span>
                    </div>

                    <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">
                      {hackathon.data.title}
                    </h3>

                    <p class="text-gray-600 dark:text-gray-300 mb-4 line-clamp-3">
                      {hackathon.data.description}
                    </p>

                    {hackathon.data.result && (
                      <div class="mb-4">
                        <span class="inline-flex items-center px-3 py-1 text-sm rounded-full font-medium bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200">
                          {hackathon.data.result}
                        </span>
                      </div>
                    )}

                    <div class="flex flex-wrap gap-2 mb-4">
                      {hackathon.data.technologies.slice(0, 3).map((tech) => (
                        <span class="px-2 py-1 bg-purple-600 text-white text-xs rounded">
                          {tech}
                        </span>
                      ))}
                      {hackathon.data.technologies.length > 3 && (
                        <span class="px-2 py-1 bg-gray-100 dark:bg-gray-900 text-gray-600 dark:text-gray-400 text-xs rounded">
                          +{hackathon.data.technologies.length - 3} more
                        </span>
                      )}
                    </div>

                    <div class="flex items-center justify-between">
                      <a
                        href={`/hackathons/${hackathon.slug}`}
                        class="inline-flex items-center text-purple-600 hover:text-purple-800 dark:text-purple-400 dark:hover:text-purple-300 font-medium"
                      >
                        Read Story
                        <svg
                          class="w-4 h-4 ml-2"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 5l7 7-7 7"
                          />
                        </svg>
                      </a>

                      <div class="flex space-x-3">
                        {hackathon.data.githubUrl && (
                          <a
                            href={hackathon.data.githubUrl}
                            class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"
                          >
                            <span class="sr-only">GitHub</span>
                            <svg
                              class="w-4 h-4"
                              fill="currentColor"
                              viewBox="0 0 24 24"
                            >
                              <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                            </svg>
                          </a>
                        )}
                        {hackathon.data.devpostUrl && (
                          <a
                            href={hackathon.data.devpostUrl}
                            class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"
                          >
                            <span class="sr-only">Devpost</span>
                            <svg
                              class="w-4 h-4"
                              fill="none"
                              stroke="currentColor"
                              viewBox="0 0 24 24"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                              />
                            </svg>
                          </a>
                        )}
                      </div>
                    </div>
                  </div>
                </article>
              );
            })
          }
        </div>
      </section>
    </div>
  </div>
</MainLayout>

<script>
  // Hackathon filtering functionality
  document.addEventListener("DOMContentLoaded", function () {
    const hackathonCards = document.querySelectorAll(".hackathon-card");
    let activeFilters = {
      technology: "all",
      year: "all",
      role: "all",
    };

    function filterHackathons() {
      hackathonCards.forEach((card) => {
        const htmlCard = card as HTMLElement;
        const cardTechnologies =
          htmlCard.getAttribute("data-technologies") || "";
        const cardYear = htmlCard.getAttribute("data-year") || "";
        const cardRole = htmlCard.getAttribute("data-role") || "";

        const techMatch =
          activeFilters.technology === "all" ||
          cardTechnologies.includes(activeFilters.technology);
        const yearMatch =
          activeFilters.year === "all" || cardYear === activeFilters.year;
        const roleMatch =
          activeFilters.role === "all" || cardRole === activeFilters.role;

        if (techMatch && yearMatch && roleMatch) {
          htmlCard.style.display = "block";
        } else {
          htmlCard.style.display = "none";
        }
      });
    }

    // Set up filter buttons
    document.querySelectorAll(".filter-btn").forEach((button) => {
      button.addEventListener("click", () => {
        const filter = button.getAttribute("data-filter");
        const type = button.getAttribute("data-type");

        // Update active button in the same category
        const categoryButtons = document.querySelectorAll(
          `[data-type="${type}"]`
        );
        categoryButtons.forEach((btn) => {
          btn.classList.remove("active");
          if (type === "technology") {
            btn.classList.remove("bg-purple-600", "text-white");
            btn.classList.add("text-purple-600");
          } else if (type === "year") {
            btn.classList.remove("bg-blue-600", "text-white");
            btn.classList.add("text-blue-600");
          } else if (type === "role") {
            btn.classList.remove("bg-green-600", "text-white");
            btn.classList.add("text-green-600");
          }
        });

        button.classList.add("active");
        if (type === "technology") {
          button.classList.add("bg-purple-600", "text-white");
          button.classList.remove("text-purple-600");
        } else if (type === "year") {
          button.classList.add("bg-blue-600", "text-white");
          button.classList.remove("text-blue-600");
        } else if (type === "role") {
          button.classList.add("bg-green-600", "text-white");
          button.classList.remove("text-green-600");
        }

        // Update active filters
        if (type) {
          activeFilters[type as keyof typeof activeFilters] = filter || "all";
        }
        filterHackathons();
      });
    });
  });
</script>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .filter-btn.active {
    font-weight: 600;
  }
</style>
